# Тестововое задание комании Betting Software - Группа сервисов для совершения ставок

## LineProvider
 - Реализация выполнена с помощью фреймворка faststream с использованием RabbitMQ в качестве брокера сообщений. 
 - Так как решение было в свободной форме, я решил немного отойти от использования API и сделал сервис автогенерации 
событий и их результатов. Они работают асинхронно. 
 - События создаются каждые 5 - 10 секунд со случайными коэффициентами 
и временем жизни, ограниченными только 2 минутами. 
 - Параллельно, каждые 5 секунд работает контролер событий, 
который при наступлении deadline выбирает случаное завершение(победа, проигрыш). 
 - События сохраняются локально в памяти.
 - В очередь передаются новые события и исходы старых. При завершении события и отправке результата, событие удаляется.

## BetMaker
 - Сервис выполнен с помощью фреймворка fastapi, с использованием faststream и sqlalchemy.
 - Работа происходит следующим образом. Приложение прослушивает очередь сообщений и ожидает новые события.
 - При получении нового события оно сохраняется в Redis с ограниченным ttl, который равен разнице между текущим и deadline временем события.
 - Сервис позволяет сделать ставку. Для ее создания указывается id события и сумма ставки. 
 - После информацию можно получить в методе GET /bets с указанием offset и limit для пагинации. 
 - Сервис прослушивает очередь с сообщениями об исходе события, получает все ставки с этим событием и обновляют их в соответсвии с результатом.
 - Ставки сохраняются в PostgreSQL. 

## Запуск
Запустить стек сервисов командой
```shell
docker compose up -d
```
Сервисы запустятся, после этого можно перейти на http://127.0.0.1:8002/docs для работы с приложением. 